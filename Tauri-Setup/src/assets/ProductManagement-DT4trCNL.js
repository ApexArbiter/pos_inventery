import{r as c,e as x,V as n,j as e,P as V}from"./index-CZ0aMDF1.js";import{P as G}from"./plus-Cz38fBgY.js";import{S as W}from"./search-DZxNIAtT.js";import{S as H}from"./square-pen-BUDrwwgU.js";import{T as J}from"./trash-2-GDRDrBLX.js";const Z=()=>{const[S,C]=c.useState([]),[F,I]=c.useState([]),[y,g]=c.useState(!1),[m,R]=c.useState(""),[U,p]=c.useState(!1),[h,b]=c.useState(null),[f,w]=c.useState(!1),[r,l]=c.useState({productName:"",barcode:"",category:"",sellingPrice:"",costPrice:"",isReturnable:!0,description:"",unit:"pcs",images:[]});c.useEffect(()=>{j(),D()},[]);const j=async()=>{try{g(!0);const t=await x.get("/products");C(t.data.data||[])}catch(t){console.error("Failed to load products:",t),n.error("Failed to load products")}finally{g(!1)}},D=async()=>{try{const t=await x.get("/categories");I(t.data.data||[])}catch(t){console.error("Failed to load categories:",t)}},L=async t=>{var a,d;if(t){if(!t.type.startsWith("image/")){n.error("Please select a valid image file");return}if(t.size>5*1024*1024){n.error("Image size should be less than 5MB");return}w(!0);try{const s=new FormData;s.append("image",t),s.append("folder","products");const i=await x.post("/upload/image",s,{headers:{"Content-Type":"multipart/form-data"}});if(i.data.success){const o=i.data.data.secure_url;l(u=>({...u,images:[...u.images,{url:o,isPrimary:u.images.length===0}]})),n.success("Image uploaded successfully!")}else throw new Error(i.data.message||"Upload failed")}catch(s){console.error("Image upload error:",s),n.error("Failed to upload image: "+(((d=(a=s.response)==null?void 0:a.data)==null?void 0:d.message)||s.message))}finally{w(!1)}}},M=t=>{l(a=>({...a,images:a.images.filter((d,s)=>s!==t)}))},A=t=>{l(a=>({...a,images:a.images.map((d,s)=>({...d,isPrimary:s===t}))}))},E=async t=>{var a,d;t.preventDefault();try{g(!0);const i=["kg","ltr","pcs","gms","ml","box","pack","dozen","pair"].includes(r.unit)?r.unit:"pcs",o={...r,unit:i,sellingPrice:parseFloat(r.sellingPrice),costPrice:parseFloat(r.costPrice),mrp:parseFloat(r.sellingPrice),isReturnable:r.isReturnable,createdBy:"68d9b88797f4b497a5f255b8",storeId:"68d9b866b68fb44566d71515"};console.log("Form data unit:",r.unit),console.log("Valid unit:",i),console.log("Product data being sent:",o),h?(await x.put(`/products/${h._id}`,o),n.success("Product updated successfully!")):(await x.post("/products",o),n.success("Product added successfully!")),p(!1),b(null),l({productName:"",barcode:"",category:"",sellingPrice:"",costPrice:"",isReturnable:!0,description:"",unit:"pcs",images:[]}),j()}catch(s){console.error("Failed to save product:",s),n.error(((d=(a=s.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to save product")}finally{g(!1)}},_=t=>{b(t);const d=["kg","ltr","pcs","gms","ml","box","pack","dozen","pair"].includes(t.unit)?t.unit:"pcs";l({productName:t.productName||"",barcode:t.barcode||"",category:t.category||"",sellingPrice:t.sellingPrice||"",costPrice:t.costPrice||"",isReturnable:t.isReturnable!==void 0?t.isReturnable:!0,description:t.description||"",unit:d,images:t.images||[]}),p(!0)},z=async t=>{if(window.confirm("Are you sure you want to delete this product?"))try{await x.delete(`/products/${t}`),n.success("Product deleted successfully!"),j()}catch(a){console.error("Failed to delete product:",a),n.error("Failed to delete product")}},[B,$]=c.useState([]);c.useEffect(()=>{T()},[]);const T=async()=>{try{const t=await x.get("/inventory/levels");$(t.data.data||[])}catch(t){console.error("Failed to load inventory data:",t)}},q=t=>B.find(a=>a.productId===t),P=S.filter(t=>t.productName.toLowerCase().includes(m.toLowerCase())||t.barcode.includes(m)||t.category.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(V,{className:"w-6 h-6 mr-2"}),"Product Management"]}),e.jsxs("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Add Product"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search products by name, barcode, or category...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:m,onChange:t=>R(t.target.value)})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Barcode"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Inventory Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:y?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center text-gray-500",children:"Loading products..."})}):P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center text-gray-500",children:"No products found"})}):P.map(t=>{var a,d,s;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("img",{className:"h-10 w-10 rounded-lg object-cover",src:((d=(a=t.images)==null?void 0:a[0])==null?void 0:d.url)||"https://via.placeholder.com/40x40?text=No+Image",alt:t.productName})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.productName}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.description||"No description"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.barcode}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:t.category})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:["Rs.",((s=t.sellingPrice)==null?void 0:s.toFixed(2))||"0.00"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:(()=>{const i=q(t._id);if(!i)return e.jsxs("div",{className:"text-gray-500 text-xs",children:[e.jsx("div",{children:"No inventory data"}),e.jsx("div",{className:"text-red-500",children:"Stock: 0"})]});const o=i.currentStock||0,u=i.availableStock||0,v=i.reorderPoint||0;let k="text-green-600",N="In Stock";return o===0?(k="text-red-600",N="Out of Stock"):o<=v&&(k="text-yellow-600",N="Low Stock"),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:["Stock: ",o]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${k} ${o===0?"bg-red-100":o<=v?"bg-yellow-100":"bg-green-100"}`,children:N})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Available: ",u," | Reorder: ",v]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Value: Rs.",(i.totalValue||0).toFixed(2)]})]})})()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>_(t),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(t._id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:e.jsx(J,{className:"w-4 h-4"})})]})})]},t._id)})})]})})}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:h?"Edit Product":"Add New Product"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Product Name *"}),e.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:r.productName,onChange:t=>l({...r,productName:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Barcode *"}),e.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:r.barcode,onChange:t=>l({...r,barcode:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category *"}),e.jsxs("select",{required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:r.category,onChange:t=>l({...r,category:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Category"}),F.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Unit"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:r.unit,onChange:t=>l({...r,unit:t.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilogram"}),e.jsx("option",{value:"gms",children:"Grams"}),e.jsx("option",{value:"ltr",children:"Liter"}),e.jsx("option",{value:"ml",children:"Milliliter"}),e.jsx("option",{value:"box",children:"Box"}),e.jsx("option",{value:"pack",children:"Pack"}),e.jsx("option",{value:"dozen",children:"Dozen"}),e.jsx("option",{value:"pair",children:"Pair"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Selling Price *"}),e.jsx("input",{type:"number",step:"0.01",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:r.sellingPrice,onChange:t=>l({...r,sellingPrice:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Cost Price"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:r.costPrice,onChange:t=>l({...r,costPrice:t.target.value})})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:r.isReturnable,onChange:t=>l({...r,isReturnable:t.target.checked})}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Is Returnable"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:r.description,onChange:t=>l({...r,description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Product Images"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:t=>L(t.target.files[0]),className:"hidden",id:"image-upload",disabled:f}),e.jsx("label",{htmlFor:"image-upload",className:`inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 ${f?"opacity-50 cursor-not-allowed":""}`,children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Upload Image"]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max 5MB, JPG/PNG/GIF"})]}),r.images.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:r.images.map((t,a)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.url,alt:`Product ${a+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-300"}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center space-x-2",children:[e.jsx("button",{onClick:()=>A(a),className:`px-2 py-1 text-xs rounded ${t.isPrimary?"bg-green-600 text-white":"bg-blue-600 text-white hover:bg-blue-700"}`,children:t.isPrimary?"Primary":"Set Primary"}),e.jsx("button",{onClick:()=>M(a),className:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"Remove"})]})]},a))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{p(!1),b(null)},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:y?"Saving...":h?"Update Product":"Add Product"})]})]})]})})})]})};export{Z as default};
